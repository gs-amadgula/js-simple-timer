<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Timer Test</title>
</head>

<body>
    <div id="timer">
        <div id="time">
            0h:0m:0s:00ms
        </div>
        <div id="controls">
            <button id="start">Start</button>
            <!-- <button id="pause">Pause</button> -->
            <button id="stop">Stop</button>
            <button id="reset">Reset</button>
        </div>
    </div>

    <style>
        body {
            text-align: center;
        }

        #timer {
            background-color: rgb(218, 218, 218);
            color: #f260a2;
            padding-top: 60px;
            padding-bottom: 20px;
            text-align: center;
            height: 100px;
            width: 500px;
            border-radius: 5px;
        }

        button {
            background-color: #e0315d;
            border-radius: 2px;
        }
    </style>

    <script>

        var Timer = /** @class */ (function () {
            function Timer() {
                this.startTime = 0;
                this.endTime = 0;
                this.time = 0;
                // #region Seconds
                this.secondsId = undefined;
                this.seconds = 1;
                this.secondsListener = undefined;
                // #endregion
                // #region Minutes
                this.minutesId = undefined;
                this.minutes = 1;
                this.minutesListener = undefined;
                // #endregion
                // #region Hours
                this.hoursId = undefined;
                this.hours = 1;
                this.hoursListener = undefined;
                // #endregion
                this.format = 'h:m:s:ms';
                this.timeouts = [];
            }
            Timer.prototype.start = function () {
                this.startTime = this.endTime = Date.now();
                console.log('timer started');
                this.secondsUpdated();
            };
            // public pause(): void {
            //     this.endTime = Date.now();
            //     this.time += (this.endTime - this.startTime);
            //     this.startTime = this.endTime = Date.now();
            //     console.log('timer paused');
            // }
            Timer.prototype.stop = function () {
                this.endTime = Date.now();
                console.log('timer stopped');
                this.time += (this.endTime - this.startTime);
                if (this.secondsId) {
                    console.log('seconds stopping');
                    this.clearSeconds();
                }
                if (this.minutesId) {
                    console.log('minutes stopping');
                    this.clearMinutes();
                }
                if (this.hoursId) {
                    console.log('hours stopping');
                    this.clearHours();
                }
                return this.getTime();
            };
            Timer.prototype.reset = function () {
                this.startTime = this.endTime = Date.now();
                console.log('timer reset');
                if (this.secondsId)
                    this.clearSeconds();
                if (this.minutesId)
                    this.clearMinutes();
                if (this.hoursId)
                    this.clearHours();
            };
            Timer.prototype.secondsUpdated = function (callback) {
                var _this = this;
                if (callback === void 0) { callback = undefined; }
                if (typeof callback == 'function')
                    this.secondsListener = callback;
                if (this.startTime)
                    if (!this.secondsId) {
                        this.secondsId = setInterval(function (_) {
                            ++_this.seconds;
                            if (_this.secondsListener)
                                _this.secondsListener(_this.seconds);
                        }, 1000);
                    }
            };
            Timer.prototype.clearSeconds = function () {
                clearInterval(this.secondsId);
                this.secondsId = undefined;
            };
            Timer.prototype.minutesUpdated = function (callback) {
                var _this = this;
                if (callback === void 0) { callback = undefined; }
                if (typeof callback == 'function')
                    this.minutesListener = callback;
                if (this.startTime)
                    if (!this.minutesId) {
                        this.minutesId = setInterval(function (_) {
                            ++_this.minutes;
                            if (_this.minutesListener)
                                _this.minutesListener(_this.minutes);
                        }, 60000);
                    }
            };
            Timer.prototype.clearMinutes = function () {
                clearInterval(this.minutesId);
                this.minutesId = undefined;
            };
            Timer.prototype.hoursUpdated = function (callback) {
                var _this = this;
                if (callback === void 0) { callback = undefined; }
                if (typeof callback == 'function')
                    this.hoursListener = callback;
                if (this.startTime)
                    if (!this.hoursId) {
                        this.hoursId = setInterval(function (_) {
                            ++_this.hours;
                            if (_this.hoursListener)
                                _this.hoursListener(_this.hours);
                        }, 1000);
                    }
            };
            Timer.prototype.clearHours = function () {
                clearInterval(this.hoursId);
                this.hoursId = undefined;
            };
            Timer.prototype.getTime = function () {
                this.endTime = Date.now();
                this.time = (this.endTime - this.startTime);
                var time = this.time / 1000;
                var hours = parseInt((time / 3600).toFixed(2));
                var minutes = parseInt((time / 60).toFixed(2));
                var seconds = parseInt((time % 60).toFixed(2));
                var milliseconds = parseInt((time * 100).toFixed(0));
                return this.format.replace('h', hours + "h")
                    .replace('m', minutes + "m")
                    .replace('ms', milliseconds + "ms")
                    .replace('s', seconds + "s");
            };
            Timer.prototype.countdown = function (timeout, callback) {
                // console.log(this.timeouts);
                // this.timeouts.push(timeout);
                // let to = 0;
                // if (this.timeouts != [])
                //     this.timeouts.reduce(t => {
                //         to += t;
                //     }, to);
                setTimeout(function () {
                    callback();
                }, timeout);
                return this;
            };
            Timer.prototype.getHours = function () {
                return parseInt((this.time / 3600).toFixed(2));
            };
            Timer.prototype.getMinutes = function () {
                return parseInt((this.time / 60).toFixed(2));
            };
            Timer.prototype.getSeconds = function () {
                return parseInt((this.time % 60).toFixed(2));
            };
            return Timer;
        }());

        const timer = new Timer();

        const start = document.getElementById('start');

        start.addEventListener('click', e => {
            timer.start();
        });

        // const pause = document.getElementById('pause');

        // pause.addEventListener('click', e => {
        //     timer.pause();
        // });

        const stop = document.getElementById('stop');

        stop.addEventListener('click', e => {
            timer.stop();
        });

        const reset = document.getElementById('reset');

        reset.addEventListener('click', e => {
            timer.reset();
            time.innerText = timer.getTime();
        });

        const time = document.getElementById('time');

        timer.secondsUpdated(seconds => {
            console.log(timer.getTime());
            time.innerText = timer.getTime();
        });

    </script>

    <script>

    </script>

</body>

</html>